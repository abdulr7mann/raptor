<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>API Pentest Report</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #0d1117; color: #c9d1d9; padding: 2rem; }
  h1 { color: #58a6ff; margin-bottom: 0.5rem; }
  h2 { color: #79c0ff; margin: 2rem 0 1rem; border-bottom: 1px solid #21262d; padding-bottom: 0.5rem; }
  h3 { color: #c9d1d9; margin: 1rem 0 0.5rem; }
  .meta { color: #8b949e; margin-bottom: 2rem; }
  .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin: 1rem 0; }
  .summary-card { background: #161b22; border: 1px solid #21262d; border-radius: 8px; padding: 1.2rem; text-align: center; }
  .summary-card .number { font-size: 2rem; font-weight: bold; }
  .summary-card .label { color: #8b949e; font-size: 0.85rem; margin-top: 0.3rem; }
  .critical { color: #f85149; }
  .high { color: #f0883e; }
  .medium { color: #d29922; }
  .low { color: #58a6ff; }
  .info { color: #8b949e; }
  .pass { color: #3fb950; }
  .fail { color: #f85149; }
  .error { color: #f0883e; }
  table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
  th { background: #161b22; color: #79c0ff; text-align: left; padding: 0.7rem; border-bottom: 2px solid #21262d; }
  td { padding: 0.7rem; border-bottom: 1px solid #21262d; }
  tr:hover { background: #161b22; }
  .finding-card { background: #161b22; border: 1px solid #21262d; border-radius: 8px; padding: 1.2rem; margin: 0.8rem 0; }
  .finding-card .severity-badge { display: inline-block; padding: 2px 10px; border-radius: 12px; font-size: 0.8rem; font-weight: bold; }
  .badge-critical { background: #f8514922; color: #f85149; border: 1px solid #f85149; }
  .badge-high { background: #f0883e22; color: #f0883e; border: 1px solid #f0883e; }
  .badge-medium { background: #d2992222; color: #d29922; border: 1px solid #d29922; }
  .badge-low { background: #58a6ff22; color: #58a6ff; border: 1px solid #58a6ff; }
  .badge-info { background: #8b949e22; color: #8b949e; border: 1px solid #8b949e; }
  .evidence { background: #0d1117; border: 1px solid #21262d; border-radius: 4px; padding: 0.8rem; margin: 0.5rem 0; font-family: monospace; font-size: 0.85rem; overflow-x: auto; }
  .evidence-timing { color: #8b949e; font-size: 0.8rem; margin: 0.3rem 0; }
  details { margin: 0.5rem 0; }
  summary { cursor: pointer; color: #58a6ff; }
  .owasp-tag { background: #21262d; color: #79c0ff; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; }
</style>
</head>
<body>
<h1>API Penetration Test Report</h1>
<p class="meta">Generated: {{ timestamp }}</p>

<h2>Executive Summary</h2>
<div class="summary-grid">
  <div class="summary-card"><div class="number">{{ summary.total_tests }}</div><div class="label">Total Tests</div></div>
  <div class="summary-card"><div class="number pass">{{ summary.passed }}</div><div class="label">Passed</div></div>
  <div class="summary-card"><div class="number fail">{{ summary.failed }}</div><div class="label">Failed</div></div>
  <div class="summary-card"><div class="number critical">{{ summary.severity.Critical }}</div><div class="label">Critical</div></div>
  <div class="summary-card"><div class="number high">{{ summary.severity.High }}</div><div class="label">High</div></div>
  <div class="summary-card"><div class="number medium">{{ summary.severity.Medium }}</div><div class="label">Medium</div></div>
  <div class="summary-card"><div class="number low">{{ summary.severity.Low }}</div><div class="label">Low</div></div>
  <div class="summary-card"><div class="number info">{{ summary.severity.Info }}</div><div class="label">Info</div></div>
</div>

<h2>Findings</h2>
{% if findings %}
{% for finding in findings %}
<div class="finding-card">
  <span class="severity-badge badge-{{ finding.severity | lower }}">{{ finding.severity }}</span>
  {% if finding.owasp_id %}
  <span class="owasp-tag">{{ finding.owasp_id }}</span>
  {% endif %}
  <h3>{{ finding.title }}</h3>
  <p>{{ finding.description }}</p>
  <p><strong>Endpoint:</strong> {{ finding.endpoint }}</p>
  {% if finding.remediation %}
  <p><strong>Remediation:</strong> {{ finding.remediation }}</p>
  {% endif %}
  {% if finding.evidence_html %}
  <details>
    <summary>View Evidence</summary>
    {{ finding.evidence_html }}
  </details>
  {% endif %}
</div>
{% endfor %}
{% else %}
<p style="color: #3fb950;">No findings detected.</p>
{% endif %}

<h2>Test Results</h2>
<table>
<tr><th>Scenario</th><th>Test</th><th>Endpoint</th><th>Status</th><th>Details</th></tr>
{% for result in results %}
<tr>
  <td>{{ result.scenario_id }}</td>
  <td>{{ result.test_name }}</td>
  <td>{{ result.endpoint_name }}</td>
  <td class="{{ result.status | lower }}">{{ result.status }}</td>
  <td>{{ result.details }}</td>
</tr>
{% endfor %}
</table>

<hr style="border-color: #21262d; margin: 2rem 0;">
<p class="meta">Generated by API Pentest Toolkit</p>
</body>
</html>
